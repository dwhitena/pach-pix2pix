{
  "pipeline": {
    "name": "checkpoint"
  },
  "transform": {
    "image": "dwhitena/pix2pix",
    "cmd": [ "/bin/bash" ],
    "stdin": [
	"python pix2pix.py --mode train --output_dir /pfs/out --max_epochs 2 --input_dir /pfs/training --which_direction BtoA", 
	"sed -i 's/out/checkpoint/g' /pfs/out/checkpoint"
    ],
    "overwrite": true
  },
  "parallelism_spec": {
    "strategy": "CONSTANT",
    "constant": "1"
  },
  "inputs": [
    {
      "repo": {
        "name": "training"
      },
      "method": "global"
    }
  ]
}
{
  "pipeline": {
    "name": "model"
  },
  "transform": {
    "image": "dwhitena/pix2pix",
    "cmd": [ "/bin/bash" ],
    "stdin": [ 
	"python pix2pix.py --mode export --output_dir /pfs/out --checkpoint /pfs/checkpoint",
	"sed -i 's/out/model/g' /pfs/out/checkpoint" 
    ],
    "overwrite": true
  },
  "parallelism_spec": {
    "strategy": "CONSTANT",
    "constant": "1"
  },
  "inputs": [
    {
      "repo": {
        "name": "checkpoint"
      },
      "method": "global"
    }
  ]
}
{
  "pipeline": {
    "name": "preprocess_images"
  },
  "transform": {
    "image": "dwhitena/pix2pix",
    "cmd": [ "/bin/bash" ],
    "stdin": [
	"python process.py --input_dir /pfs/input_images --operation resize --output_dir /pfs/out"	
    ]
  },
  "parallelism_spec": {
    "strategy": "CONSTANT",
    "constant": "1"
  },
  "inputs": [
    {
      "repo": {
        "name": "input_images"
      }
    }
  ]
}
{
  "pipeline": {
    "name": "generate_images"
  },
  "transform": {
    "image": "dwhitena/pix2pix",
    "cmd": [ "/bin/bash" ],
    "stdin": [
	"for filename in /pfs/preprocess_images/*; do",
		"rawname=$(basename $filename)",
		"python process-local.py --model_dir /pfs/model --input_file $filename --output_file /pfs/out/$rawname",	
	"done"
    ]
  },
  "parallelism_spec": {
    "strategy": "CONSTANT",
    "constant": "1"
  },
  "inputs": [
    {
      "repo": {
        "name": "preprocess_images"
      }
    },
    {
      "repo": {
	"name": "model"
      },
      "method": "global"
    }
  ]
}
